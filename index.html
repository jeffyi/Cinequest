<!doctype html>
<html>

<head>
	<title>Cinequest</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<style type="text/css">

	</style>
	<script>
		
		var proxy;
		var selectedTab;
		var festival;			// the festival object
		var schedules;			// the Cinequest XML schedules file
		var schedule;			// the schedule object
		var allFilms;			
		var dvds;
		var forums;
		var filmsDates = {};	// to store lists of films by date 
		var weekDay;
		
		$(function(){

			proxy = "cinequestProxy.php?";
			weekDay = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
			getFestival();
			getSchedules();
			getAllFilms();
			getDVDs();
			getForums();


			if (typeof localStorage['selectedTab'] != 'undefined')
			{
				selectedTab = localStorage['selectedTab'];
			}
			else
			{
				selectedTab = -1;
			}

			if (typeof localStorage['schedule'] != 'undefined')
			{
				schedule = JSON.parse(localStorage['schedule']);
			}

			$('#festival').on('pageshow', function(){
				if (selectedTab == -1 || selectedTab == 0)
				{
					$('#filmsTab').attr('checked', true).checkboxradio('refresh');
					$('#eventsTab').attr('checked', false).checkboxradio('refresh');
					$('#forumsTab').attr('checked', false).checkboxradio('refresh');
					$('#events').hide();
					$('#forums').hide();
					$('#films').show();
					selectedTab = 0;
					localStorage['selectedTab'] = selectedTab;
				}
				else if (selectedTab == 1)
				{
					$('#eventsTab').attr('checked', true).checkboxradio('refresh');
					$('#filmsTab').attr('checked', false).checkboxradio('refresh');
					$('#forumsTab').attr('checked', false).checkboxradio('refresh');
					$('#films').hide();
					$('#forums').hide();
					$('#events').show();
					selectedTab = 1;
					localStorage['selectedTab'] = selectedTab;
				}
				else if (selectedTab == 2)
				{
					$('#forumsTab').attr('checked', true).checkboxradio('refresh');
					$('#eventsTab').attr('checked', false).checkboxradio('refresh');
					$('#filmsTab').attr('checked', false).checkboxradio('refresh');
					$('#films').hide();
					$('#events').hide();
					$('#forums').show();
					selectedTab = 2;
					localStorage['selectedTab'] = selectedTab;
				}
			});

			$('#filmsTab').click(function(){
				$('#events').hide();
				$('#forums').hide();
				$('#films').show();
				selectedTab = 0;
				localStorage['selectedTab'] = selectedTab;
				$('#filmsTab').attr('checked', true).checkboxradio('refresh');
				$('#eventsTab').attr('checked', false).checkboxradio('refresh');
				$('#forumsTab').attr('checked', false).checkboxradio('refresh');
			});
			$('#eventsTab').click(function(){
				$('#films').hide();
				$('#forums').hide();
				$('#events').show();
				selectedTab = 1;
				localStorage['selectedTab'] = selectedTab;
				$('#eventsTab').attr('checked', true).checkboxradio('refresh');
				$('#filmsTab').attr('checked', false).checkboxradio('refresh');
				$('#forumsTab').attr('checked', false).checkboxradio('refresh');
			});
			$('#forumsTab').click(function(){
				$('#events').hide();
				$('#films').hide();
				$('#forums').show();
				selectedTab = 2;
				localStorage['selectedTab'] = selectedTab;
				$('#forumsTab').attr('checked', true).checkboxradio('refresh');
				$('#eventsTab').attr('checked', false).checkboxradio('refresh');
				$('#filmsTab').attr('checked', false).checkboxradio('refresh');
			});

			$('#events').append('<h1>Test 2</h1>');
		});

		function getFestival(){
			$.ajax({
				type: "GET",
				url: proxy + "type=festival",
				beforeSend: function(xhr){
					$('body').addClass('ui-loading');		
				},
				success: function(xml){
					festival = xml;
					localStorage['festival'] = festival;
					console.log('ajax success for festival');
					loadDates();
					loadAllFilms();
					if (typeof localStorage['currentDateFilms'] != 'undefined')
					{
						listFilms(localStorage['currentDateFilms']);
					}
					if (typeof localStorage['currentFilmDetail'] != 'undefined')
					{
						showFilmDetail(localStorage['currentFilmDetail'], localStorage['currentFilmId']);		
					}
				},
				error: function(xhr){
					console.log('ajax failed for festival:' + xhr.statusText);
				},
				complete: function(xhr){
					$('body').removeClass('ui-loading');
				}
			});
		}

		function loadDates(){
			var currentDate = '';
			var dateParts;
			var dateDisplay;
			var count = -1;
			var htmlString = '';
			var tag;
			var nextDate;
			$(schedules).find('schedule').each(function(){
				tag = $(this);
				nextDate = tag.attr('start_time').split(' ')[0];
				if (nextDate !== currentDate)
				{
					dateParts = nextDate.split('-');
					dateDisplay = dateParts[1] + '-' + dateParts[2] + '-' + dateParts[0];
					filmsDates[dateDisplay] = [];
					if (count > 0)
					{
						htmlString += '</a><span class="ui-li-count">' + count + '</span></li>' + '<li><a href="#filmsDates" onclick="listFilms(\'' + dateDisplay + '\')">' + weekDay[(new Date(dateParts[0], dateParts[1] - 1, dateParts[2])).getDay()] + ', ' + dateDisplay;
					}
					else
					{
						htmlString += '<li><a href="#filmsDates" onclick="listFilms(\'' + dateDisplay + '\')">' + weekDay[(new Date(dateParts[0], dateParts[1] - 1, dateParts[2])).getDay()] + ', ' + dateDisplay;
					}
					count = 1;
					currentDate = nextDate;
				}
				else
				{
					count++;		
				}
				filmsDates[dateDisplay].push({"id": tag.attr('id'), "pid": tag.attr('program_item_id'), "title": tag.attr('title'), "startTime": tag.attr('start_time'), "endTime": tag.attr('end_time'), "venue": tag.attr('venue')});
			});
			htmlString += '</a><span class="ui-li-count">' + count + '</span></li>';
			$('#list-dates').html(htmlString);
			localStorage['filmsDates'] = JSON.stringify(filmsDates);
			if ($('#list-dates').hasClass('ui-listview'))
			{
				$('#list-dates').listview('refresh');
			}
			else
			{
				$('#list-dates').trigger('create');
			}
		}

		function convertTime(h, m){
			if (h < 12)
			{
				return h + ':' + m + ' AM';
			}
			else
			{
				return (h == 12 ? h + ':' + m + ' PM' : h - 12 + ':' + m + ' PM');
			}
		}

		function listFilms(dateString){
			localStorage['currentDateFilms'] = dateString;
			var films = filmsDates[dateString];
			var startTime;
			var endTime;
			var scheduled;
			var htmlString = '';
			for (var i = 0; i < films.length; i++)
			{
				scheduled = false;
				startTime = films[i]['startTime'].split(' ')[1].split(':');
				endTime = films[i]['endTime'].split(' ')[1].split(':');
				if (typeof schedule != 'undefined')
				{
					for (var j = 0; j < schedule['data'].length; j++)
					{
						if (films[i]['id'] == schedule['data'][j]['id'])
						{
							scheduled = true;	
							break;
						}
					}
				}
				htmlString += '<li><a id="' + films[i]['id'] + '"';
				if (scheduled)
				{
					htmlString += ' style="background-color: #387bbe" ';		
				}
				htmlString += ' onclick="updateScheduleFilms(\'' + films[i]['id']  + '\', \'' + films[i]['pid'] + '\', \'film\',  \'' + films[i]['title'].replace("\\", "\\\\").replace("'", "\\\'") + '\', \'' + films[i]['startTime'] + '\', \'' + films[i]['endTime'] + '\', \'' + films[i]['venue'] + '\')">' + '<h1>' + films[i]['title']  + '</h1><p><small>' + convertTime(startTime[0], startTime[1]) + ' - ' + convertTime(endTime[0], endTime[1]) + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Venue: ' + films[i]['venue']  + '</small>';
				if (scheduled)
				{
					htmlString += '<span class="schedule"><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Scheduled)</small></span>';		
				}
				htmlString += '</p></a><a href="#filmDetail" id="s' + films[i]['id']  + '" onclick="showFilmDetail(\'' + films[i]['pid']  + '\', \'null\')"></a></li>';
			}
			$('#name-filmsDates').html('<h2>Films on ' + dateString  + '</h2>');
			$('#list-filmsDates').html(htmlString);
			if ($('#list-filmsDates').hasClass('ui-listview'))
			{
				$('#list-filmsDates').listview('refresh');
			}
			else
			{
				$('#list-filmsDates').trigger('create');
			}
		}

		function showFilmDetail(pid, filmId){
			localStorage['currentFilmDetail'] = pid;
			localStorage['currentFilmId'] = filmId;
			if (filmId != 'null')
			{
				$('#div-multipleFilmDetails').empty();
				showSingleFilmDetail(pid, filmId, true, false);
				return;
			}
			var tag;
			var films = [];
			var filmIndex;
			$(festival).find('program_item').each(function(){
				if ($(this).attr('id') == pid)
				{
					tag = $(this);
					tag.find('film').each(function(){
						films.push($(this).attr('id'));		
					});
				}
			});

			if (films.length == 0)
			{
				$('#div-multipleFilmDetails').empty();
				$('#list-filmDetail').empty();
				var htmlString ='<div align="center" style="padding: 0px 10px"><h3>' + tag.find('title').text() + '</h3></div><div style="padding: 0px 10px"><p><small>' + tag.find('description').text() + '</small></p></div>';
				$('#top-filmDetail').html(htmlString);
			}
			else if (films.length == 1)
			{
				$('#div-multipleFilmDetails').empty();
				showSingleFilmDetail(pid, films[0], true, false);		
			}
			else
			{
				showMultipleFilmDetails(pid, films, tag);
			}

		}

		function showMultipleFilmDetails(pid, films, tag){
			var htmlString = '<div align="center" style="padding: 0px 10px"><h3>' + tag.find('title').text() + '</h3></div><div style="padding: 0px 10px"><p><small>' + tag.find('description').text() + '</small></p></div><div align="center" style="padding: 0px 10px"><legend><strong>' + films.length + ' films available</strong></legend><div data-role="controlgroup" data-type="horizontal">';
			for (var i = 0; i < films.length; i++)
			{
				htmlString += '<input type="radio" id="radio-filmDetail' + i + '" onclick="showSingleFilmDetail(' + pid + ', ' + films[i] + ', ' + 'false, true' + ')" name="radio-filmDetail" value="' + i + '"';
				if (i == 0)
				{
					htmlString += ' checked="checked" />';		
				}
				else
				{
					htmlString += ' />';		
				}
				htmlString += '<label for="radio-filmDetail' + i + '">' + (i + 1) + '</label>';
			}
			htmlString += '</div></div>';
			$('#div-multipleFilmDetails').html(htmlString);
			$('#div-multipleFilmDetails').trigger('create');
			showSingleFilmDetail(pid, films[0], true, false);
		}

		function showSingleFilmDetail(pid, filmId, refreshListview, refreshRadio){
			localStorage['currentFilmDetail'] = pid;
			var tag;

			if (refreshRadio){
				$('#div-multipleFilmDetails input').checkboxradio('refresh');		
			}

			$(festival).find('films').each(function(){
				$(this).find('film').each(function(){
					tag = $(this);
					if (tag.attr('id') == filmId)
					{
						var htmlString = '<div align="center" style="padding: 0px 10px"><h3>' + tag.find('title').text() + '</h3></div><div align="center"><img src="' + tag.find('imageURL').text()  + '" style="max-width: 100%" /></div>';
						htmlString += '<div style="padding: 0px 10px"><p><small>' + tag.find('description').text() + '</small></p><p><small><strong>Genre: </strong>' + tag.find('genre').text() + '<br /><strong>Director: </strong>' + tag.find('director').text() + '<br /><strong>Producer: </strong>' + tag.find('producer').text() + '<br /><strong>Cinematographer: </strong>' + tag.find('cinematographer').text() + '<br /><strong>Editor: </strong>' + tag.find('editor').text() + '<br /><strong>Cast: </strong>' + tag.find('cast').text() + '<br /><strong>Country: </strong>' + tag.find('country').text() + '<br /><strong>Language: </strong>' + tag.find('language').text() + '</small></p>';
						htmlString += '<div align="center"><h4>Schedules (tap to add/remove)</h4></div>';
						$('#top-filmDetail').html(htmlString);

						if (!refreshListview)
						{
							return false;
						}
						htmlString = '';
						var scheduled;
						var startTime;
						var endTime;
						var dateParts;
						var dateDisplay;
						$(schedules).find('schedule').each(function(){
							var tag = $(this);
							if (tag.attr('program_item_id') == pid)
							{
								scheduled = false;
								startTime = tag.attr('start_time').split(' ')[1].split(':');
								endTime = tag.attr('end_time').split(' ')[1].split(':');
								dateParts = tag.attr('start_time').split(' ')[0].split('-'); 
								dateDisplay = dateParts[1] + '-' + dateParts[2] + '-' + dateParts[0];
								if (typeof schedule != 'undefined')
								{
									for (var j = 0; j < schedule['data'].length; j++)
									{
										if (tag.attr('id') == schedule['data'][j]['id'])
										{
											scheduled = true;	
											break;
										}
									}
								}
								htmlString += '<li><a id="fd' + tag.attr('id') + '"' 
								if (scheduled)
								{
									htmlString += ' style="background-color: #387bbe" ';		
								}
								htmlString += ' onclick="updateScheduleFilms(\'fd' + tag.attr('id')  + '\', \'' + tag.attr('program_item_id') + '\', \'film\', \'' + tag.attr('title').replace("\\", "\\\\").replace("'", "\\\'") + '\', \'' + tag.attr('startTime') + '\', \'' + tag.attr('endTime') + '\', \'' + tag.attr('venue') + '\')">' + '<h1>' + weekDay[(new Date(dateParts[0], dateParts[1] - 1, dateParts[2])).getDay()] + ', ' + dateDisplay + '</h1><p><small>' + convertTime(startTime[0], startTime[1]) + ' - ' + convertTime(endTime[0], endTime[1]) + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Venue: ' + tag.attr('venue') + '</small>';
								if (scheduled)
								{
									htmlString += '<span class="schedule"><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Scheduled)</small></span>';		
								}
								
								htmlString += '</li>';
							}
						});
						$('#list-filmDetail').html(htmlString);
						if ($('#list-filmDetail').hasClass('ui-listview'))
						{
							$('#list-filmDetail').listview('refresh');
						}
						else
						{
							$('#list-filmDetail').trigger('create');
						}
						return false;
					}
				});
			});
		}

		function updateScheduleFilms(id, pid, type, title, startTime, endTime, venue){
			if (id.substring(0, 2) == 'fd')
			{
				if ($('#' + id + ' span.schedule').length == 0)
				{
					updateSchedule(id.replace('fd', ''), pid, 'film', title, startTime, endTime, venue, true);
					$('#' + id + ' > p').append('<span class="schedule"><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Scheduled)</small></span>');
					$('#' + id).css({'background-color': '#387bbe'});
					$('#' + id.replace('fd', '') + ' > p').append('<span class="schedule"><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Scheduled)</small></span>');
					$('#' + id.replace('fd', '')).css({'background-color': '#387bbe'});
				}
				else
				{
					updateSchedule(id.replace('fd', ''), pid, 'film', title, startTime, endTime, venue, false);
					$('#' + id + ' span.schedule').remove();
					$('#' + id).css({'background-color': 'rgba(0, 0, 0, 0)'});
					$('#' + id.replace('fd', '') + ' span.schedule').remove();
					$('#' + id.replace('fd', '')).css({'background-color': 'rgba(0, 0, 0, 0)'});
				}
				return;
			}
			if ($('#' + id + ' span.schedule').length == 0)
			{
				updateSchedule(id.replace('fd', ''), pid, 'film', title, startTime, endTime, venue, true);
				$('#' + id + ' > p').append('<span class="schedule"><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Scheduled)</small></span>');
				$('#' + id).css({'background-color': '#387bbe'});
			}
			else
			{
				updateSchedule(id.replace('fd', ''), pid, 'film', title, startTime, endTime, venue, false);
				$('#' + id + ' span.schedule').remove();
				$('#' + id).css({'background-color': 'rgba(0, 0, 0, 0)'});
			}
		}

		function updateSchedule(id, pid, type, title, startTime, endTime, venue, isAdd){
			if (isAdd)
			{
				if (typeof schedule == 'undefined')
				{
					schedule = {"data": [{
						"id": id,
						"pid": pid,
						"type": type,
						"title": title,
						"startTime": startTime,
						"endTime": endTime,
						"venue": venue
					}]};
					localStorage['schedule'] = JSON.stringify(schedule);
				}
				else
				{
					schedule['data'].push({
						"id": id,
						"pid": pid,
						"type": type,
						"title": title,
						"startTime": startTime,
						"endTime": endTime,
						"venue": venue
					});
					localStorage['schedule'] = JSON.stringify(schedule);
				}			
			}
			else
			{
				for (var i = 0; i < schedule['data'].length; i++)
				{
					if (schedule['data'][i]['id'] == id)
					{
						schedule['data'].splice(i, 1);
						localStorage['schedule'] = JSON.stringify(schedule);
					}
				}
			}
		}

		function loadMySchedule(){
			if (typeof schedule == 'undefined')
			{
				$('#list-schedule').empty();
				return;
			}
			if (schedule['data'].length == 0)
			{
				$('#list-schedule').empty();
				return;
			}
			var htmlString ='';
			for (var i = 0; i < schedule['data'].length; i++)
			{
				
			}
		}

		function sortMySchedule(){
			schedule['data'].sort(function(a, b){
				if (a.startTime > b.startTime)
				{
					return 1;		
				}
				if (a.startTime < b.startTime)
				{
					return -1;
				}
				return 0;
			});
		}

		function loadAllFilms(){
			var htmlString = '';
			var tag;
			var currentSort = null;
			$(allFilms).find('film').each(function(){
				tag = $(this);
				if (currentSort == null){
					currentSort = tag.attr('sort');		
					htmlString += '<li data-role="list-divider">' + currentSort + '</li>';
				}
				if (!(currentSort == tag.attr('sort'))){
					currentSort = tag.attr('sort');		
					htmlString += '<li data-role="list-divider">' + currentSort + '</li>';
				}
				htmlString += '<li><a href="#filmDetail" onclick="showFilmDetail(\'' + tag.attr('program_item_id')  + '\', \'' + tag.attr('id') + '\')">' + tag.find('title').text()  + '</a></li>';		
			});
			$('#list-allFilms').html(htmlString);
			if ($('#list-allFilms').hasClass('ui-listview'))
			{
				$('#list-allFilms').listview('refresh');		
			}
			else
			{
				$('#list-allFilms').trigger('create');
			}

		}
		
		function loadDVDs(){	
			var lastSort='0'
			$(dvds).find('film').each(function(index){
				var item = $('<li/>');
				var link = $('<a/>');
				var tag = $(this);
				var id = tag.attr('id');	
				var sort = tag.attr('sort');
				var title = tag.find('title').text();
				link.html(title);
				
				(function(filmId){
					link.click(function(){
						window.location='#filmDetail';
						$('#div-multipleFilmDetails').empty();
						$('#top-filmDetail').empty();
						$('#list-filmDetail').empty();
						
						getDVD(filmId);
					});
				})(id);
				
				item.html(link);
				if(sort!=lastSort){
					var divider = $('<li/>');
					divider.attr('data-role','list-divider');
					divider.html(sort);
					$('#list-dvds').append(divider);	
					lastSort = sort;
				}
				$('#list-dvds').append(item);				
			});
			$('#list-dvds:visible').listview('refresh');			
		}
		
		function loadDVD(dvd){
			var dvdHandle = $(dvd);
			var title = $('<p/>').html(dvdHandle.find('title').text());			
			var imageURL = dvdHandle.find('imageURL').text();
			var image = $('<img/>').attr('src',imageURL);
			image.css('max-width','100%');
			var filmHeader = $('<div/>');
			filmHeader.css('text-align','center');
			filmHeader.append($('<div/>').html(title));
			filmHeader.append($('<div/>').html(image));
			var description = dvdHandle.find('description').text();			
			var director = dvdHandle.find('director').text();
			var producer = dvdHandle.find('producer').text();			
			var editor = dvdHandle.find('editor').text();
			var writer = dvdHandle.find('writer').text();
			var cast = dvdHandle.find('cast').text();
			var country = dvdHandle.find('country').text();
			var language = dvdHandle.find('language').text();
			var genre = dvdHandle.find('genre').text();
			var film_info = dvdHandle.find('film_info').text();
			var filmContent = $('<small/>');
			filmContent.append($('<p/>').html(description));
			filmContent.append($('<div/>').html('<strong>Director: </strong>'+director));
			filmContent.append($('<div/>').html('<strong>Producer: </strong>'+producer));
			filmContent.append($('<div/>').html('<strong>Editor: </strong>'+editor));
			filmContent.append($('<div/>').html('<strong>Writer: </strong>'+writer));
			filmContent.append($('<div/>').html('<strong>Cast: </strong>'+cast));
			filmContent.append($('<div/>').html('<strong>Country: </strong>'+country));
			filmContent.append($('<div/>').html('<strong>Language: </strong>'+language));
			filmContent.append($('<div/>').html('<strong>Genre: </strong>'+genre));
			filmContent.append($('<div/>').html('<strong>Film Info: </strong>'+film_info));
			var filmContentDiv = $('<div/>');
			filmContentDiv.css('margin','0 1em 0 1em');
			filmContentDiv.html(filmContent);
			$('#top-filmDetail').append($('<h3/>').html(filmHeader));
			$('#top-filmDetail').append(filmContentDiv);					
		}
		
		function loadForums(){	
			$(forums).find('schedule').each(function(index){
				console.log('load forum each');
				var item = $('<li/>');
				var link = $('<a/>');
				var tag = $(this);
				var id = tag.attr('mobile_item_id');	
				var title = $('<div/>').html(tag.attr('title'));				
				title.css('text-overflow','ellipsis');
				title.css('overflow','hidden');
				var startTime = tag.attr('start_time');
				var s = new Date(startTime);
				var ampm = '';
				if(s.getHours()>=12)
					ampm='PM';
				else
				    ampm='AM';
				var startTimeSpan = $('<span/>').html('Time: '+s.getHours()%12+':'+('0'+s.getMinutes()).slice(-2)+ampm);
				var endTime =  tag.attr('end_time');
				var e = new Date(endTime);
				var endTimeSpan = $('<span/>').html(' - '+e.getHours()%12+':'+('0'+e.getMinutes()).slice(-2)+ampm);
				var venue =  $('<span/>').html('Venue: '+tag.attr('venue'));
				venue.css('margin','0 0 0 2em');
				var lowerDiv = $('<div/>');
				lowerDiv.append(startTimeSpan);
				lowerDiv.append(endTimeSpan);
				lowerDiv.append(venue);
				link.append(title);
				link.append($('<small/>').html(lowerDiv));	
				(function(programId){
					link.click(function(){
						window.location='#filmDetail';
						$('#div-multipleFilmDetails').empty();
						$('#top-filmDetail').empty();
						$('#list-filmDetail').empty();
						
						getForum(programId);
					});
				})(id);
				
				item.html(link);			
				$('#list-forums').append(item);				
			});
			if ($('#list-forums').hasClass('ui-listview'))
				$('#list-forums').listview('refresh');		
			else
				$('#list-forums').trigger('create');	
		}
		
		function loadForum(forum){		
			var dvdHandle = $(forum);
			var title = $('<p/>').html($('<h3/>').html(dvdHandle.find('title').text()));	
			title.css('text-align','center');
			var description = $('<div/>').html($('<small/>').html(dvdHandle.find('description').text()));	
			description.css('margin','0 1em 0 1em');
			$('#top-filmDetail').append(title);
			$('#top-filmDetail').append(description);	
		}
		
		function getSchedules(){
			$.ajax({
				type: "GET",
				url: proxy + "type=schedules",
				success: function(xml){
					schedules = xml;
					localStorage['schedules'] = xml;
					console.log('ajax success for schedules');
				},
				error: function(xhr){
					console.log('ajax failed for schedules' + xhr.statusText);		
				}
			});
		}

		function getAllFilms(){
			$.ajax({
				type: "GET",
				url: proxy + "type=films",
				success: function(xml){
					allFilms = xml;
					console.log('ajax success for all films');

				},
				error: function(xhr){
					console.log('ajax failed for all films')
				}
			});
		}

		function getDVDs(){
			$.ajax({
				type: "GET",
				url: proxy + "type=dvds",
				success: function(xml){
					dvds = xml;
					localStorage['dvds'] = xml;
					console.log('ajax success for dvds');
					loadDVDs();
				},
				error: function(xhr){
					console.log('ajax failed for schedules' + xhr.statusText);		
				}
			});
		}
		
		function getDVD(dvdId){
			$.ajax({
				type: "GET",
				url: proxy + "type=dvd&id="+dvdId,
				success: function(xml){
					var dvd = xml;
					localStorage['dvd'+dvdId] = xml;
					console.log('ajax success for dvds');
					loadDVD(dvd);
				},
				error: function(xhr){
					console.log('ajax failed for schedules' + xhr.statusText);		
				}
			});
		}
		
		function getForums(d){
			$.ajax({
				type: "GET",
				url: proxy + "type=xml&name=events",
				success: function(xml){
					var event = xml;
					forums = $(event).find('forums');
					localStorage['forums'] = xml;
					console.log('ajax success for forums');
					loadForums();
				},
				error: function(xhr){
					console.log('ajax failed for schedules' + xhr.statusText);		
				}
			});
		}
		
		function getForum(id){
			$.ajax({
				type: "GET",
				url: proxy + "type=program_item&id="+id,
				success: function(xml){
					var forum = xml;
					localStorage['forum'+id] = xml;
					console.log('ajax success for forums');
					loadForum(forum);
				},
				error: function(xhr){
					console.log('ajax failed for schedules' + xhr.statusText);		
				}
			});
		}
		
		function cp_schedule(){
			$.mobile.changePage('#schedule');		
			$.mobile.showPageLoadingMsg();
			setTimeout(function(){
				$.mobile.hidePageLoadingMsg();},
				3000
			);
		}



	</script>
</head>

<body>
<!-- Index page -->
	<div data-role="page" id="index" data-title="Cinequest - Home" data-theme="a" data-content-theme="a">

		<div data-role="header" data-id="mainheader" data-position="fixed" data-tap-toggle="false">
			<h1>Cinequest</h1>
			<a href="#schedule" class="ui-btn-right" data-icon="grid" data-iconpos="right">Schedule</a>
			<div data-role="navbar">
				<ul>
					<li><a class="ui-btn-active ui-state-persist">Home</a></li>
					<li><a href="#festival">Festival</a></li>
					<li><a href="#dvds">DVDs</a></li>
				</ul>
			</div>
		</div>

		<div data-role="content">
			<div align="center">
				<img id="img-cinequest" src="img/creative.gif" style="max-width: 100%" />
			</div>
		</div>

	</div>

<!-- Festival page -->
	<div data-role="page" id="festival" data-title="Cinequest - Festival" data-theme="a" data-content-theme="a">

		<div data-role="header" data-id="mainheader" data-position="fixed" data-tap-toggle="false">
			<h1>Cinequest</h1>
			<a href="#schedule" class="ui-btn-right" data-icon="grid" data-iconpos="right">Schedule</a>
			<div data-role="navbar">
				<ul>
					<li><a href="#index">Home</a></li>
					<li><a class="ui-btn-active ui-state-persist">Festival</a></li>
					<li><a href="#dvds">DVDs</a></li>
				</ul>
			</div>
		</div>
		
		<div data-role="content">
			<div data-role="controlgroup" data-type="horizontal" align="center">
				<input type="radio" id="filmsTab" name="festival-tabs" />
				<label for="filmsTab"><small>Films</small></label>
				<input type="radio" id="eventsTab" name="festival-tabs" />
				<label for="eventsTab"><small>Events</small></label>
				<input type="radio" id="forumsTab" name="festival-tabs" />
				<label for="forumsTab"><small>Forums</small></label>
			</div>

		<!-- Films page -->
			<div id="films" style="display:none">
				<br />
				<a id="bt-films-listAll" href="#allFilms" data-role="button">Show all films</a>
				<br />
				<ul id="list-dates" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Filter dates...">
					
				</ul>
			</div>

		<!-- Events page -->
			<div id="events" style="display:none">

			</div>

		<!-- Forums page -->
			<div id="forums" style="display:none">
				<br />
				<ul id="list-forums" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Filter forums...">
					
				</ul>
			</div>



		</div>

	</div>

<!-- DVDs page -->
	<div data-role="page" id="dvds" data-title="Cinequest - DVDs" data-theme="a" data-content-theme="a">

		<div data-role="header" data-id="mainheader" data-position="fixed" data-tap-toggle="false">
			<h1>Cinequest</h1>
			<a href="#schedule" class="ui-btn-right" data-icon="grid" data-iconpos="right">Schedule</a>
			<div data-role="navbar">
				<ul>
					<li><a href="#index">Home</a></li>
					<li><a href="#festival">Festival</a></li>
					<li><a class="ui-btn-active ui-state-persist">DVDs</a></li>
				</ul>
			</div>
		</div>

		<div data-role="content">
			<ul id="list-dvds" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Filter dvds...">
					
			</ul>
		</div>

	</div>

<!-- FilmsDates page -->
	<div data-role="page" id="filmsDates" data-add-back-btn="true"data-theme="a" data-content-theme="a">
		
		<div data-role="header" data-id="mainheader" data-position="fixed" data-tap-toggle="false">
			<h1>Cinequest</h1>
			<a href="#schedule" class="ui-btn-right" data-icon="grid" data-iconpos="right">Schedule</a>
		</div>

		<div data-role="content">
			<div id="name-filmsDates" align="center">

			</div>

			<ul id="list-filmsDates" data-role="listview" data-filter="true" data-filter-placeholder="Filter films..." data-inset="true" data-split-theme="a">

			</ul>
		</div>

	</div>

<!-- FilmDetail page -->
	<div data-role="page" id="filmDetail" data-title="Cinequest - Film Detail" data-add-back-btn="true" data-theme="a" data-content-theme="a">
		
		<div data-role="header" data-id="mainheader" data-position="fixed" data-tap-toggle="false">
			<h1>Cinequest</h1>
			<a href="#schedule" class="ui-btn-right" data-icon="grid" data-iconpos="right">Schedule</a>
		</div>

		<div id="content-filmDetail" data-role="content" style="padding: 0px 0px">
			<div id="div-multipleFilmDetails">
			</div>
			<div id="top-filmDetail">
			</div>
			<div style="padding: 0px 10px">
				<ul id="list-filmDetail" data-role="listview" data-inset="true" data-icon="false">
				</ul>
			</div>
		</div>

	</div>

<!-- AllFilms page -->
	<div data-role="page" id="allFilms" data-title="Cinequest - Films" data-add-back-btn="true" data-theme="a" data-content-theme="a">

		<div data-role="header" data-id="mainheader" data-position="fixed" data-tap-toggle="false">
			<h1>Cinequest</h1>
			<a href="#schedule" class="ui-btn-right" data-icon="grid" data-iconpos="right">Schedule</a>
		</div>

		<div data-role="content" id="content-allFilms">
			<br />
			<ul data-role="listview" id="list-allFilms" data-filter="true" data-filter-placeholder="Filter films...">
			</ul>
		</div>

	</div>

<!-- Schedule page -->
	<div data-role="page" id="schedule" data-title="Cinequest - Schedule" data-add-back-btn="true"data-theme="a" data-content-theme="a">
		
		<div data-role="header" data-id="mainheader" data-position="fixed" data-tap-toggle="false">
			<h1>My Cinequest<br /> Schedule</h1>
			<a class="ui-btn-right" data-icon="delete" data-iconpos="right">Delete</a>
		</div>

		<div data-role="content">
			<ul id="list-schedule" data-role="listview" data-inset="true">
			</ul>
		</div>
		
	</div>


</body>

</html>











